<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Query Agent - Project Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'dark' });</script>
    <style>
        :root {
            --bg-primary: #0F1115;
            --bg-secondary: #14171C;
            --bg-card: #1B1F26;
            --text-primary: #E6EAF0;
            --text-secondary: #A0A7B4;
            --accent: #4F8CFF;
            --border: #242A36;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            margin-bottom: 60px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        h2 {
            font-size: 1.8rem;
            margin-top: 40px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
            padding-left: 15px;
            color: #fff;
        }

        h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-top: 25px;
        }

        p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .card-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tech-tag {
            background-color: rgba(79, 140, 255, 0.1);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        code {
            background-color: #2D3442;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            color: #E6EAF0;
        }

        .diagram-container {
            background-color: var(--bg-secondary);
            padding: 40px;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        section {
            margin-bottom: 50px;
        }

        .workflow-step {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .step-number {
            background-color: var(--accent);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>IT Query Agent Architecture</h1>
            <p>Comprehensive documentation of the full-stack RAG application.</p>
        </header>

        <section>
            <h2>üß¨ RAG Architecture Diagram</h2>
            <p>The following diagram illustrates the lifecycle of a user query in the Retrieval-Augmented Generation
                (RAG) pipeline.</p>
            <div class="diagram-container">
                <div class="mermaid">
                    graph TD
                    User([User In Input Area]) --> ChatInput[ChatInput Component]
                    ChatInput --> API[FastAPI: /chat/send]

                    subgraph "Backend Orchestration (rag_engine.py)"
                    API --> QueryProcess[Process Query]
                    QueryProcess --> VectorSearch[Query ChromaDB Vector Store]
                    VectorSearch -.-> Chroma[(ChromaDB)]
                    Chroma -.-> Chunks[Retrieved Document Chunks]

                    Chunks --> Augment[Augment Context]
                    Mem[Memory Service] --> Augment

                    Augment --> LLM[AWS Bedrock: Claude 3]
                    end

                    LLM --> Response[Generate Response]
                    Response --> APIOut[Return JSON Payload]
                    APIOut --> MessageList[Render in MessageList]
                    MessageList --> UserUI([Visible Response + Sources])

                    style User fill:#4F8CFF,stroke:#fff,stroke-width:2px,color:#fff
                    style UserUI fill:#4F8CFF,stroke:#fff,stroke-width:2px,color:#fff
                    style LLM fill:#10a37f,stroke:#fff,stroke-width:2px,color:#fff
                    style Chroma fill:#242A36,stroke:#fff,stroke-width:2px,color:#fff
                    style Augment fill:#2D3442,stroke:#4F8CFF,stroke-width:2px
                </div>
            </div>
        </section>

        <section>
            <h2>üèóÔ∏è Architecture & Tech Stack</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-title">Frontend</div>
                    <div>
                        <span class="tech-tag">React</span>
                        <span class="tech-tag">Vite</span>
                        <span class="tech-tag">CSS Modules</span>
                    </div>
                    <p>Single Page Application (SPA) managing state for chat sessions, user preferences (dark mode), and
                        real-time streaming of responses.</p>
                </div>
                <div class="card">
                    <div class="card-title">Backend</div>
                    <div>
                        <span class="tech-tag">FastAPI</span>
                        <span class="tech-tag">Python 3.10+</span>
                        <span class="tech-tag">Uvicorn</span>
                    </div>
                    <p>High-performance ASGI server handling API requests, document processing, and RAG orchestration.
                    </p>
                </div>
                <div class="card">
                    <div class="card-title">Data & AI</div>
                    <div>
                        <span class="tech-tag">LangChain</span>
                        <span class="tech-tag">ChromaDB</span>
                        <span class="tech-tag">AWS Bedrock</span>
                    </div>
                    <p>Vector storage for document embeddings and LLM integration for generating final answers.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>üìÇ File Structure & Functionality</h2>

            <h3>Backend Components (<code>/backend</code>)</h3>
            <div class="grid">
                <div class="card">
                    <div class="card-title"><code>app/main.py</code></div>
                    <p>The entry point. Configures the FastAPI app, CORS settings, and routes. Orchestrates the startup
                        sequence.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/rag_engine.py</code></div>
                    <p><strong>The Core Brain.</strong> Orchestrates retrieval, memory, and generation. Fetches relevant
                        context from the vector store and prompts the LLM.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/bedrock_client.py</code></div>
                    <p>Handles authentication and communication with AWS Bedrock to access Claude models.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/vector_store.py</code></div>
                    <p>Manages the <strong>ChromaDB</strong> interface. Handles creating collections, adding document
                        embeddings, and querying.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/document_processor.py</code></div>
                    <p>Parses uploaded files (PDFs, text), chunks them, and prepares them for vectorization.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/session_manager.py</code></div>
                    <p>Handles chat session persistence, allowing users to have multiple distinct conversations.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>services/memory_service.py</code></div>
                    <p>Manages short-term conversational memory so the AI remembers context within a session.</p>
                </div>
            </div>

            <h3>Frontend Components (<code>/frontend/src</code>)</h3>
            <div class="grid">
                <div class="card">
                    <div class="card-title"><code>App.jsx</code></div>
                    <p>Main application controller. Manages global state like themes, user identity, and session
                        switching.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>components/ChatInterface.jsx</code></div>
                    <p>The main chat view container. Coordinates the MessageList and ChatInput, and handles the
                        "Knowledge Base" toggle.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>components/Sidebar.jsx</code></div>
                    <p><strong>Navigation Hub.</strong> Handles creating new chats, searching history, switching
                        sessions, and user profile management.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>components/MessageList.jsx</code></div>
                    <p>Renders the chat history. Handles Markdown rendering, typing indicators, source citations, and
                        copy functionality.</p>
                </div>
                <div class="card">
                    <div class="card-title"><code>components/ChatInput.jsx</code></div>
                    <p>The user input area. detailed styling for the floating pill design and auto-expanding textarea.
                    </p>
                </div>
                <div class="card">
                    <div class="card-title"><code>index.css</code></div>
                    <p>Global styles and CSS variables. Defines the color palette (Light/Dark mode) and typography
                        system.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>‚öôÔ∏è Key Workflows</h2>

            <h3>1. The RAG Pipeline (Chat)</h3>
            <div class="workflow-step">
                <div class="step-number">1</div>
                <div>
                    <strong>User Query</strong>
                    <p>User sends a message via <code>ChatInput</code>. Frontend calls <code>api.sendMessage()</code>.
                    </p>
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">2</div>
                <div>
                    <strong>Retrieval (Backend)</strong>
                    <p><code>rag_engine.py</code> converts the query to an embedding and searches <code>ChromaDB</code>
                        for the most relevant document chunks.</p>
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">3</div>
                <div>
                    <strong>Augmentation & Generation</strong>
                    <p>The retrieved chunks + chat history + user query are sent to Claude (AWS Bedrock).</p>
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">4</div>
                <div>
                    <strong>Response</strong>
                    <p>The LLM generates an answer. The backend returns this answer along with the "Sources" used to the
                        frontend.</p>
                </div>
            </div>

            <h3>2. Document Ingestion</h3>
            <div class="workflow-step">
                <div class="step-number">1</div>
                <div>
                    <strong>Upload</strong>
                    <p>User uploads a doc via <code>IngestionModal</code>.</p>
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">2</div>
                <div>
                    <strong>Processing</strong>
                    <p><code>document_processor.py</code> reads and splits the text.</p>
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">3</div>
                <div>
                    <strong>Indexing</strong>
                    <p><code>rag_engine.py</code> embeds the text chunks and stores them in <code>vector_store.py</code>
                        (ChromaDB).</p>
                </div>
            </div>
        </section>
    </div>
</body>

</html>